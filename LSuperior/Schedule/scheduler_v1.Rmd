---
title: "Lake Superior Creel Scheduler"
header-includes:
   - \usepackage{booktabs}
   - \usepackage[table]{xcolor}
   - \usepackage{colortbl}
output: 
  pdf_document:
    includes:
      in_header: preamble.tex
---

\fontsize{14}{18}
\selectfont
\pagenumbering{gobble}

```{r input, echo=FALSE}
## User Inputs
YEAR <- 2019
LAKE <- "Superior"
ROUTE <- c("Corny-PW")
SEED <- 34583489
```

```{r setup, include=FALSE}
library(kableExtra)
fldr <- ""
source(paste0(fldr,"Schedule_Helpers.R"))
knitr::opts_chunk$set(echo = FALSE)
options(huxtable.knitr_output_format="latex")

## Read in Route and Shift information
finfo <- paste0(fldr,"Schedule_Info_LS.xlsx")
## Load route and shift information
routes <- readRoutes(finfo,sheet="Routes") %>%
  dplyr::filter(route %in% ROUTE)
shifts <- readShifts(finfo,sheet="Shifts") %>%
  dplyr::filter(route %in% ROUTE)

## Set the random number seed
set.seed(SEED)

## Set filename for schedule data
fout <- paste0(YEAR,"_",LAKE,"_",ROUTE,"_SCHEDULE.csv")
```

**Year:** `r YEAR`

\vspace{12pt}

**Lake:** `r LAKE`

**Route:** `r ROUTE`

\vspace{12pt}

**Ran:** `r format(lubridate::now(),format="%d-%b-%Y at %H:%M")`

**Seed:** `r formatC(SEED,format="d")`

\textbf{Schedule File:} `r gsub("_","\\_",fout,fixed=TRUE)`

```{r makeSchedule, include=FALSE}
## Make the schedule
fn <- makeSchedule(YEAR,LAKE,ROUTE,routes,fout)
```

\newpage

```{r makeBusRoute, echo=FALSE, fig.width=7, fig.height=7, fig.show="asis", results="asis"}
## Get the schedule
sched <- read.csv(fn)
## Get months in schedule
mos <- as.character(unique(sched$MONTH))

for (i in mos) {
  makeCalendar(fn,MONTH1=i)
  tmp <- sched[sched$MONTH==i & sched$CREEL=="YES",]
  for (j in seq_len(nrow(tmp))) {
    br <- iMakeBusRoute(routes,shifts,
                        ROUTE=as.character(tmp$ROUTE[j]),
                        SHIFT=as.character(tmp$SHIFT[j]),
                        MONTH1=as.character(tmp$MONTH[j]))
    cat("\\newpage\n")
    print(iPrintBusRouteHeader(tmp[j,]))
    cat("\\vspace{24pt}\n")
    print(iPrintBusRoute(br))
  }
}

```
